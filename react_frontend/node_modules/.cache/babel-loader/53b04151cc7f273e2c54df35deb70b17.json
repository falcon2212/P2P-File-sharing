{"ast":null,"code":"import _regeneratorRuntime from\"/home/falcon2212/college/sem8/SPE/final-project/window-drop/react_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/falcon2212/college/sem8/SPE/final-project/window-drop/react_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/falcon2212/college/sem8/SPE/final-project/window-drop/react_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/falcon2212/college/sem8/SPE/final-project/window-drop/react_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/falcon2212/college/sem8/SPE/final-project/window-drop/react_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/falcon2212/college/sem8/SPE/final-project/window-drop/react_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{useState,useEffect,Component}from\"react\";import\"./dashboard.css\";import socketIOClient from\"socket.io-client\";import{Button,Col,Container,FormFile,ListGroup,Row}from\"react-bootstrap\";import{ArrowUpSquareFill}from\"react-bootstrap-icons\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MAXIMUM_MESSAGE_SIZE=65535;var END_OF_FILE_MESSAGE='EOF';var _require=require('arraybuffer-mime'),arrayBufferWithMime=_require.arrayBufferWithMime,arrayBufferMimeDecouple=_require.arrayBufferMimeDecouple;var arrayBufferConcat=require('arraybuffer-concat');var APP_CONFIG=require(\"../config/app_config\");var ENDPOINT=APP_CONFIG.BACKEND_ENDPOINT;var Dashboard=/*#__PURE__*/function(_Component){_inherits(Dashboard,_Component);var _super=_createSuper(Dashboard);function Dashboard(props){var _this;_classCallCheck(this,Dashboard);_this=_super.call(this,props);_this.tmp=function(event){};_this.state={configuration:{'iceServers':[{'urls':'stun:stun.l.google.com:19302'}]},room:null,chunks:[],clientList:[],isInitiator:null,clientId:null,dest_id:null,dataChannel:null,connections:{},datachannels:{},online:null,memberList:[],file:null,socket:null,downloadList:null,usernames:{}};return _this;}_createClass(Dashboard,[{key:\"renderClients\",value:function renderClients(){var onlineUsers=this.state.clientList.length===0?0:this.state.clientList.length-1;this.setState({online:onlineUsers});var html=[];if(this.state.clientList.length===1){this.setState({memberList:html});return;}for(var i=0;i<this.state.clientList.length;i++){var element=this.state.clientList[i];if(element===this.state.clientId)continue;html.push(element);this.setState({memberList:html});}}},{key:\"allConnect\",value:function allConnect(){this.setState({connections:{}});this.setState({datachannels:{}});for(var i=0;i<this.state.clientList.length;i++){var element=this.state.clientList[i];if(element===this.state.clientId)continue;this.sendConnect(element);}}},{key:\"sendConnect\",value:function(){var _sendConnect=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:this.setState({dest_id:id});this.setState({isInitiator:true});this.state.socket.emit('sendConnect',this.state.dest_id,this.state.clientId,this.state.room,this.props.login_data.login_credentials.username);return _context.abrupt(\"return\",true);case 4:case\"end\":return _context.stop();}}},_callee,this);}));function sendConnect(_x){return _sendConnect.apply(this,arguments);}return sendConnect;}()},{key:\"t\",value:function t(){console.log(Date.now());}},{key:\"createPeer\",value:function createPeer(id){var _this2=this;//var connect = document.getElementById('connect');\n//connect.style.display = 'block';\nvar tmp=this.state.connections;var tmp1=this.state.datachannels;tmp[id]=new RTCPeerConnection(this.state.configuration);tmp[id].onicecandidate=function(event){if(event.candidate){_this2.sendMessage({type:'candidate',label:event.candidate.sdpMLineIndex,id:event.candidate.sdpMid,candidate:event.candidate.candidate},id);}else{}};this.setState({connections:tmp});if(this.state.isInitiator){tmp1[id]=this.state.connections[id].createDataChannel('files');tmp1[id].binaryType='arraybuffer';this.setState({datachannels:tmp1});this.onDataChannelCreated(id);this.state.connections[id].createOffer().then(function(offer){return _this2.state.connections[id].setLocalDescription(offer);}).then(function(){_this2.sendMessage(_this2.state.connections[id].localDescription,id);}).catch(this.logError);}else{tmp[id].ondatachannel=function(event){tmp1[id]=event.channel;tmp1[id].binaryType='arraybuffer';_this2.setState({datachannels:tmp1});_this2.onDataChannelCreated(id);};this.setState({connections:tmp});}}},{key:\"sendMessage\",value:function sendMessage(message,id){this.state.socket.emit('message',message,id,this.state.clientId);}},{key:\"onDataChannelCreated\",value:function onDataChannelCreated(id){var _this3=this;var channel=this.state.datachannels;channel[id].onopen=function(){};channel[id].onclose=function(){// currentState.sendBtn = false;\n};channel[id].onmessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var data,tmp,abWithMime,_arrayBufferMimeDecou,mime,arrayBuffer,blob;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:data=event.data;try{if(data!==END_OF_FILE_MESSAGE){tmp=_this3.state.chunks;tmp.push(data);_this3.setState({chunks:tmp});}else{abWithMime=_this3.state.chunks.reduce(function(acc,arrayBuffer){var tmp=new Uint8Array(acc.byteLength+arrayBuffer.byteLength);tmp.set(new Uint8Array(acc),0);tmp.set(new Uint8Array(arrayBuffer),acc.byteLength);return tmp;},new Uint8Array());_arrayBufferMimeDecou=arrayBufferMimeDecouple(abWithMime),mime=_arrayBufferMimeDecou.mime,arrayBuffer=_arrayBufferMimeDecou.arrayBuffer;blob=new Blob([arrayBuffer],{type:mime});_this3.render1(blob,\"download\");//channel.close();\n}}catch(err){}case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref.apply(this,arguments);};}();this.setState({datachannels:channel});}},{key:\"logError\",value:function logError(err){if(!err)return;if(typeof err==='string'){console.warn(err);}else{console.warn(err.toString(),err);}}},{key:\"render1\",value:function render1(blob,fileName){var html;var url=window.URL.createObjectURL(blob);if(url){html=/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"small\",{children:/*#__PURE__*/_jsx(\"a\",{href:url,download:fileName,children:\"Incoming file\"})})});}else{html=/*#__PURE__*/_jsx(\"li\",{children:\"No files available here\"});}this.setState({downloadList:html});this.setState({chunks:[]});}},{key:\"signalingMessageCallback\",value:function signalingMessageCallback(message,id){var _this4=this;if(message.type==='offer'){this.state.connections[id].setRemoteDescription(new RTCSessionDescription(message),function(){},this.logError);this.state.connections[id].createAnswer().then(function(answer){_this4.onLocalSessionCreated(answer,id);}).catch(this.logError);}else if(message.type==='answer'){this.state.connections[id].setRemoteDescription(new RTCSessionDescription(message),function(){},this.logError);}else if(message.type==='candidate'){this.state.connections[id].addIceCandidate(new RTCIceCandidate({candidate:message.candidate,sdpMLineIndex:message.label,sdpMid:message.id}));}}},{key:\"onLocalSessionCreated\",value:function onLocalSessionCreated(desc,id){var _this5=this;this.state.connections[id].setLocalDescription(desc).then(function(){_this5.sendMessage(_this5.state.connections[id].localDescription,id);}).catch(this.logError);}},{key:\"sendFile\",value:function(){var _sendFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(ev){var id,file,arrayBuffer,mime,abWithMime,dataChannel,i;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:id=ev.target.value;// for(var i=0; i<this.state.clientList.length; i++){\n//     if(this.state.clientId === this.state.clientList[i]) continue;\n//     else{\n//         id = this.state.clientList[i];\n//     }\n// }\n// var id = element.getAttribute(\"id\");\n// var fileInput = document.getElementById('file')\nfile=this.state.file;if(!file){_context3.next=11;break;}_context3.next=5;return file.arrayBuffer();case 5:arrayBuffer=_context3.sent;mime=file.type;abWithMime=arrayBufferWithMime(arrayBuffer,mime);dataChannel=this.state.datachannels[id];for(i=0;i<abWithMime.byteLength;i+=MAXIMUM_MESSAGE_SIZE){dataChannel.send(abWithMime.slice(i,i+MAXIMUM_MESSAGE_SIZE));}dataChannel.send(END_OF_FILE_MESSAGE);case 11:case\"end\":return _context3.stop();}}},_callee3,this);}));function sendFile(_x3){return _sendFile.apply(this,arguments);}return sendFile;}()},{key:\"arrayBufferWithMime\",value:function arrayBufferWithMime(arrayBuffer,mime){var len=mime.length;var uint8=new Uint8Array(len+1);uint8[0]=len;for(var i=0;i<len;i++){var n=mime[i].charCodeAt(0);uint8[i+1]=n;}var ab=arrayBufferConcat(uint8,arrayBuffer);return ab;}},{key:\"arrayBufferMimeDecouple\",value:function arrayBufferMimeDecouple(arrayBufferWithMime){var uint8=new Uint8Array(arrayBufferWithMime);var mime='';var len=uint8[0];for(var i=0;i<len;i++){var char=uint8[i+1];mime+=String.fromCharCode(char);}var arrayBuffer=uint8.slice(len+1).buffer;return{mime:mime,arrayBuffer:arrayBuffer};}},{key:\"componentDidMount\",value:function componentDidMount(){var _this6=this;console.log(this.props.login_data.room);if(this.props.login_data.room!==null){this.state.room=window.location.hash=this.props.login_data.room;}else{this.state.room=window.location.hash=\"1\";}this.state.socket=socketIOClient.connect(ENDPOINT,{reconnect:true});this.state.socket.emit('create or join',this.state.room);this.state.socket.on('Display clients',function(clientsInRoom,isAllConnect){_this6.setState({clientList:clientsInRoom});_this6.renderClients();if(isAllConnect)_this6.allConnect();});this.state.socket.on('ready',function(dest_Id,username){var users=_this6.state.usernames;users[dest_Id]=username;_this6.setState({usernames:users});_this6.t();_this6.createPeer(dest_Id);_this6.t();});this.state.socket.on('reset',function(){window.location.reload();});this.state.socket.on('sendConnect',function(dest_Id,username){var users=_this6.state.usernames;users[dest_Id]=username;_this6.setState({usernames:users});_this6.setState({dest_id:dest_Id});_this6.setState({isInitiator:false});_this6.t();_this6.createPeer(_this6.state.dest_id);_this6.t();_this6.state.socket.emit('ready',_this6.state.dest_id,_this6.state.clientId,_this6.props.login_data.login_credentials.username);return true;});this.state.socket.on('socketid',function(id){_this6.setState({clientId:id});});this.state.socket.on('log',function(array){});this.state.socket.on('message',function(message,id){_this6.signalingMessageCallback(message,id);});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.state.socket.emit('final_step',this.state.room);}},{key:\"addFile\",value:function addFile(event){this.setState({file:event.target.files[0]});}},{key:\"createUserList\",value:function createUserList(){var _this7=this;var html=[];for(var i=0;i<this.state.memberList.length;i++){html.push(/*#__PURE__*/_jsxs(ListGroup.Item,{children:[this.state.usernames[this.state.memberList[i]],/*#__PURE__*/_jsx(Button,{value:this.state.memberList[i],onClick:function onClick(ev){return _this7.sendFile(ev);},children:\"Send file\"})]}));}return html;}},{key:\"render\",value:function render(){var _this8=this;var userList=this.createUserList();return/*#__PURE__*/_jsxs(Container,{className:\"justify-content-center mb-5 mt-5\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Users online: \",this.state.online]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(FormFile,{onChange:function onChange(e){_this8.addFile(e);},type:\"file\",\"data-browse\":\"Select file\"}),/*#__PURE__*/_jsx(\"ul\",{id:\"downloadList\",children:this.state.downloadList})]}),/*#__PURE__*/_jsx(ListGroup,{children:userList})]});}}]);return Dashboard;}(Component);export{Dashboard};","map":{"version":3,"sources":["/home/falcon2212/college/sem8/SPE/final-project/window-drop/react_frontend/src/components/Dashboard.js"],"names":["React","useState","useEffect","Component","socketIOClient","Button","Col","Container","FormFile","ListGroup","Row","ArrowUpSquareFill","MAXIMUM_MESSAGE_SIZE","END_OF_FILE_MESSAGE","require","arrayBufferWithMime","arrayBufferMimeDecouple","arrayBufferConcat","APP_CONFIG","ENDPOINT","BACKEND_ENDPOINT","Dashboard","props","tmp","event","state","configuration","room","chunks","clientList","isInitiator","clientId","dest_id","dataChannel","connections","datachannels","online","memberList","file","socket","downloadList","usernames","onlineUsers","length","setState","html","i","element","push","sendConnect","id","emit","login_data","login_credentials","username","console","log","Date","now","tmp1","RTCPeerConnection","onicecandidate","candidate","sendMessage","type","label","sdpMLineIndex","sdpMid","createDataChannel","binaryType","onDataChannelCreated","createOffer","then","offer","setLocalDescription","localDescription","catch","logError","ondatachannel","channel","message","onopen","onclose","onmessage","data","abWithMime","reduce","acc","arrayBuffer","Uint8Array","byteLength","set","mime","blob","Blob","render1","err","warn","toString","fileName","url","window","URL","createObjectURL","setRemoteDescription","RTCSessionDescription","createAnswer","answer","onLocalSessionCreated","addIceCandidate","RTCIceCandidate","desc","ev","target","value","send","slice","len","uint8","n","charCodeAt","ab","char","String","fromCharCode","buffer","location","hash","connect","reconnect","on","clientsInRoom","isAllConnect","renderClients","allConnect","dest_Id","users","t","createPeer","reload","array","signalingMessageCallback","files","sendFile","userList","createUserList","e","addFile"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, Component } from \"react\";\nimport \"./dashboard.css\";\nimport socketIOClient from \"socket.io-client\";\nimport {Button, Col, Container, FormFile, ListGroup, Row} from \"react-bootstrap\";\nimport {ArrowUpSquareFill} from \"react-bootstrap-icons\";\n\nconst MAXIMUM_MESSAGE_SIZE = 65535;\nconst END_OF_FILE_MESSAGE = 'EOF';\nconst {arrayBufferWithMime,arrayBufferMimeDecouple} = require('arraybuffer-mime');\nconst arrayBufferConcat = require('arraybuffer-concat')\n\nlet APP_CONFIG = require(\"../config/app_config\");\nconst ENDPOINT = APP_CONFIG.BACKEND_ENDPOINT;\n\nclass Dashboard extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            configuration : {\n                'iceServers': [{\n                    'urls': 'stun:stun.l.google.com:19302'\n                }]\n            },\n            room:null,\n            chunks : [],\n            clientList: [],\n            isInitiator: null,\n            clientId: null,\n            dest_id: null,\n            dataChannel: null,\n            connections : {},\n            datachannels : {},\n            online: null,\n            memberList: [],\n            file:null,\n            socket:null,\n            downloadList:null,\n            usernames:{},\n        };\n    }\n\n    renderClients (){\n        var onlineUsers = ((this.state.clientList.length === 0) ? 0 : (this.state.clientList.length - 1) );\n\n        this.setState({online: onlineUsers});\n\n        var html = [];\n        if(this.state.clientList.length === 1)\n        {\n            this.setState({memberList: html});\n            return;\n        }\n\n        for(var i=0; i<this.state.clientList.length; i++)\n        {\n            var element = this.state.clientList[i];\n            if(element === this.state.clientId) continue;\n            html.push(element);\n            this.setState({memberList: html});\n\n        }\n    }\n\n    allConnect (){\n        this.setState({connections: {}});\n        this.setState({datachannels: {}});\n        for(let i = 0;i<this.state.clientList.length;i++){\n            var element = this.state.clientList[i];\n            if(element === this.state.clientId) continue;\n            this.sendConnect(element);\n        }\n    }\n\n    async sendConnect (id){\n        this.setState({dest_id: id});\n        this.setState({isInitiator: true});\n        this.state.socket.emit('sendConnect', this.state.dest_id, this.state.clientId, this.state.room, this.props.login_data.login_credentials.username);\n        return true;\n    }\n\n    t(){\n        console.log(Date.now());\n    }\n\n    createPeer(id){\n\n        //var connect = document.getElementById('connect');\n        //connect.style.display = 'block';\n\n        let tmp = this.state.connections;\n        let tmp1 = this.state.datachannels;\n        tmp[id] = new RTCPeerConnection(this.state.configuration);\n\n        tmp[id].onicecandidate = (event) => {\n            if (event.candidate) {\n                this.sendMessage({\n                    type: 'candidate',\n                    label: event.candidate.sdpMLineIndex,\n                    id: event.candidate.sdpMid,\n                    candidate: event.candidate.candidate\n                },id);\n            } else {\n            }\n        };\n        this.setState({connections:tmp});\n\n        if (this.state.isInitiator) {\n            tmp1[id] = this.state.connections[id].createDataChannel('files');\n            tmp1[id].binaryType = 'arraybuffer';\n            this.setState({datachannels: tmp1});\n            this.onDataChannelCreated(id);\n\n            this.state.connections[id].createOffer().then((offer) => {\n                return this.state.connections[id].setLocalDescription(offer);\n            })\n                .then(() => {\n                    this.sendMessage(this.state.connections[id].localDescription, id);\n                })\n                .catch(this.logError);\n\n        } else {\n            tmp[id].ondatachannel = (event) => {\n                tmp1[id] = event.channel;\n                tmp1[id].binaryType = 'arraybuffer';\n                this.setState({datachannels: tmp1});\n                this.onDataChannelCreated(id);\n            };\n            this.setState({connections:tmp});\n        }\n    }\n\n    sendMessage (message, id) {\n        this.state.socket.emit('message', message, id, this.state.clientId);\n    }\n\n    onDataChannelCreated (id){\n\n        let channel = this.state.datachannels;\n        channel[id].onopen = () => {\n        };\n\n        channel[id].onclose = () => {\n            // currentState.sendBtn = false;\n        }\n\n        channel[id].onmessage = async (event) => {\n            const { data } = event;\n            try {\n                if (data !== END_OF_FILE_MESSAGE) {\n                    var tmp = this.state.chunks;\n                    tmp.push(data);\n                    this.setState({chunks:tmp});\n                } else {\n                    let abWithMime = this.state.chunks.reduce((acc, arrayBuffer) => {\n                        const tmp = new Uint8Array(acc.byteLength + arrayBuffer.byteLength);\n                        tmp.set(new Uint8Array(acc), 0);\n                        tmp.set(new Uint8Array(arrayBuffer), acc.byteLength);\n                        return tmp;\n                    }, new Uint8Array());\n                    const {mime, arrayBuffer} = arrayBufferMimeDecouple(abWithMime)\n                    const blob = new Blob([arrayBuffer], {type : mime});\n                    this.render1(blob, \"download\");\n                    //channel.close();\n                }\n            } catch (err) {\n            }\n        };\n        this.setState({datachannels: channel});\n    };\n\n    logError (err) {\n        if (!err) return;\n        if (typeof err === 'string') {\n            console.warn(err);\n        } else {\n            console.warn(err.toString(), err);\n        }\n    }\n\n    render1 (blob, fileName){\n        var html;\n        const url = window.URL.createObjectURL(blob);\n        if(url)\n        {\n            html = <li><small><a href={url} download={fileName}>Incoming file</a></small></li> ;\n        }\n        else\n        {\n            html = <li>No files available here</li>;\n        }\n        this.setState({downloadList: html});\n        this.setState({chunks: []});\n    }\n\n    signalingMessageCallback (message, id) {\n        if (message.type === 'offer') {\n            this.state.connections[id].setRemoteDescription(new RTCSessionDescription(message), () => {},\n                this.logError);\n            this.state.connections[id].createAnswer().then((answer) => {\n                this.onLocalSessionCreated(answer,id);\n            }).catch(this.logError);\n        } else if (message.type === 'answer') {\n            this.state.connections[id].setRemoteDescription(new RTCSessionDescription(message), () => {},\n                this.logError);\n        } else if (message.type === 'candidate') {\n            this.state.connections[id].addIceCandidate(new RTCIceCandidate({\n                candidate: message.candidate,\n                sdpMLineIndex: message.label,\n                sdpMid: message.id\n            }));\n        }\n    }\n\n    onLocalSessionCreated (desc,id) {\n        this.state.connections[id].setLocalDescription(desc).then(() => {\n            this.sendMessage(this.state.connections[id].localDescription, id);\n        }).catch(this.logError);\n    }\n\n    async sendFile(ev){\n        let id = ev.target.value;\n        // for(var i=0; i<this.state.clientList.length; i++){\n        //     if(this.state.clientId === this.state.clientList[i]) continue;\n        //     else{\n        //         id = this.state.clientList[i];\n        //     }\n        // }\n        // var id = element.getAttribute(\"id\");\n        // var fileInput = document.getElementById('file')\n        var file = this.state.file;\n\n        if(file){\n            let arrayBuffer = await file.arrayBuffer();\n            let mime = file.type;\n            let abWithMime = arrayBufferWithMime(arrayBuffer, mime)\n            let dataChannel = this.state.datachannels[id];\n\n            for (let i = 0; i < abWithMime.byteLength; i += MAXIMUM_MESSAGE_SIZE) {\n                dataChannel.send(abWithMime.slice(i, i + MAXIMUM_MESSAGE_SIZE));\n            }\n            dataChannel.send(END_OF_FILE_MESSAGE);\n        }\n    }\n\n    arrayBufferWithMime(arrayBuffer, mime) {\n        const len = mime.length\n        const uint8 = new Uint8Array(len + 1)\n\n        uint8[0] = len\n\n        for (var i = 0; i < len; i++) {\n            var n = mime[i].charCodeAt(0)\n            uint8[i+1] = n\n        }\n\n        const ab = arrayBufferConcat(uint8, arrayBuffer)\n\n        return ab\n    }\n\n    arrayBufferMimeDecouple(arrayBufferWithMime) {\n        const uint8 = new Uint8Array(arrayBufferWithMime)\n        var mime = ''\n        const len = uint8[0]\n\n        for (var i = 0; i < len; i++) {\n            var char = uint8[i+1]\n\n            mime += String.fromCharCode(char)\n        }\n\n        var arrayBuffer = uint8.slice(len+1).buffer\n\n        return {\n            mime: mime,\n            arrayBuffer: arrayBuffer\n        }\n    }\n\n    componentDidMount() {\n        console.log(this.props.login_data.room)\n        if (this.props.login_data.room !== null) {\n            this.state.room = window.location.hash = this.props.login_data.room;\n        }\n        else {\n            this.state.room = window.location.hash = \"1\";\n        }\n\n        this.state.socket = socketIOClient.connect(ENDPOINT, {reconnect: true});\n\n        this.state.socket.emit('create or join', this.state.room);\n\n        this.state.socket.on('Display clients', (clientsInRoom, isAllConnect) => {\n            this.setState({clientList: clientsInRoom});\n            this.renderClients();\n            if(isAllConnect) this.allConnect();\n        });\n\n        this.state.socket.on('ready', (dest_Id, username) => {\n\n            let users = this.state.usernames;\n            users[dest_Id] = username;\n            this.setState({usernames: users});\n\n            this.t();\n            this.createPeer(dest_Id);\n            this.t();\n        });\n\n        this.state.socket.on('reset', () => {\n            window.location.reload();\n        });\n\n        this.state.socket.on('sendConnect', (dest_Id, username) => {\n\n            let users = this.state.usernames;\n            users[dest_Id] = username;\n            this.setState({usernames: users});\n\n            this.setState({dest_id: dest_Id});\n            this.setState({isInitiator: false});\n            this.t();\n            this.createPeer(this.state.dest_id);\n            this.t();\n            this.state.socket.emit('ready', this.state.dest_id, this.state.clientId, this.props.login_data.login_credentials.username);\n            return true;\n        });\n\n        this.state.socket.on('socketid', (id) => {\n            this.setState({clientId: id});\n        });\n\n        this.state.socket.on('log', (array) => {\n        });\n\n        this.state.socket.on('message', (message, id) => {\n            this.signalingMessageCallback(message, id);\n        });\n    }\n\n    componentWillUnmount() {\n        this.state.socket.emit('final_step', this.state.room);\n    }\n\n    addFile(event){\n        this.setState({file: event.target.files[0]});\n    }\n\n    tmp = (event) => {\n    }\n    createUserList() {\n        let html = [];\n        for(var i=0; i<this.state.memberList.length; i++){\n            html.push(\n                <ListGroup.Item>\n                    {this.state.usernames[this.state.memberList[i]]}<Button value={this.state.memberList[i]} onClick={(ev) => this.sendFile(ev)}>Send file</Button>\n                    {/*<Row className={\"p-2\"}>*/}\n                    {/*    <Col>{this.state.memberList[i]}</Col>*/}\n                    {/*    /!*<Col><Form.File onChange={(e) => {this.addFile(e)}} type={\"file\"} className={\"custom-file-label\"} label={this.state.memberList[i]} custom/></Col>*!/*/}\n                    {/*    <Col className={\"justify-content-end\"}><Button value={this.state.memberList[i]} onClick={(ev) => this.sendFile(ev.target.value)}/></Col>*/}\n                    {/*</Row>*/}\n                </ListGroup.Item>\n            );\n        }\n        return html;\n    }\n\n    render() {\n        let userList = this.createUserList();\n        return(\n            <Container className={\"justify-content-center mb-5 mt-5\"}>\n                <div>\n                    Users online: {this.state.online}\n                </div>\n                <div>\n                    {/*<FormFile onChange={(e) => {this.addFile(e)}} type={\"file\"} className={\"custom-file-label\"} label={\"Select file\"} custom/>*/}\n                    <FormFile onChange={(e) => {this.addFile(e)}} type={\"file\"} data-browse={\"Select file\"}/>\n                    <ul id=\"downloadList\">{this.state.downloadList}</ul>\n                </div>\n                <ListGroup>\n                    {userList}\n                </ListGroup>\n            </Container>\n        );\n    }\n}\n\nexport {Dashboard};\n\n"]},"metadata":{},"sourceType":"module"}